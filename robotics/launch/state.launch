<launch>
################################ Nodelet Manager ###############################
    <node pkg="nodelet" type="nodelet" name="imu_manager"
      args="manager" output="screen" />
################################ IMU Driver ####################################
  <node pkg="nodelet" type="nodelet" name="PhidgetsImuNodelet"
    args="load phidgets_imu/PhidgetsImuNodelet imu_manager"
    output="screen">

    # supported data rates: 4 8 16 24 32 40 ... 1000 (in ms)
    <param name="period" value="4"/>
    <param name="cc_mag_field" value="0.49503"/>
         <param name="cc_offset0" value="0.03905"/>
         <param name="cc_offset1" value="0.16602"/>
         <param name="cc_offset2" value="0.01644"/>
         <param name="cc_gain0" value="1.92198"/>
         <param name="cc_gain1" value="1.97463"/>
         <param name="cc_gain2" value="2.16361"/>
         <param name="cc_t0" value="0.02108"/>
         <param name="cc_t1" value="-0.07194"/>
         <param name="cc_t2" value="0.01935 "/>
         <param name="cc_t3" value="0.02142"/>
         <param name="cc_t4" value="-0.06751"/>
         <param name="cc_t5" value="0.02152"/>
  </node>

############################ IMU Orientation Filter ############################
  <node pkg="nodelet" type="nodelet" name="ImuFilterNodelet"
    args="load imu_filter_madgwick/ImuFilterNodelet imu_manager" respawn="true"
    output="screen">

    <param name="use_mag" value="true"/>
    <param name="world_frame" value="nwu"/>
    <param name="use_magnetic_field_msg" value="true"/>

  </node>
############################ Bearing Angle Calculation #########################
  <node name="bearingCalculation_node" pkg="robotics" type="bearing.py" respawn="true" output="screen">
  </node>
################################ PID Contoller for IR #################################
    <node name="IR_PID" pkg="pid" type="controller" output="screen" respawn="true">
      <param name="Kp" value="2" />
      <param name="Ki" value="0"/>
      <param name="Kd" value="1" />
      <param name="upper_limit" value="800" />
      <param name="lower_limit" value="-800" />
      <param name="windup_limit" value="10" />
      <param name="cutoff_frequency" value="20" />
      <param name="max_loop_frequency" value="200.0" />
      <param name="min_loop_frequency" value="200.0" />
      <remap from="control_effort" to="/control_effort_ir" />
    </node>
################################ PID Contoller for Heading #################################
    <node name="HEADING_PID" pkg="pid" type="controller" output="screen" respawn="true">
      <param name="Kp" value="5" />
      <param name="Ki" value="0.5"/>
      <param name="Kd" value="2" />
      <param name="upper_limit" value="2000" />
      <param name="lower_limit" value="-2000" />
      <param name="windup_limit" value="10" />
      <param name="cutoff_frequency" value="20" />
      <param name="max_loop_frequency" value="200.0" />
      <param name="min_loop_frequency" value="200.0" />
      <remap from="state" to="/bearing" />
      <remap from="setpoint" to="/setheading" />
      <remap from="control_effort" to="/control_effort_heading" />
    </node>

#################################### Pololu Node ##############################

    <node name="stateControl_node" pkg="robotics" type="stateControl.py" respawn="true" output="screen">
  </node>

</launch>
